---
title: "02_willow"
format: html
editor: visual
---

## 02_Willow

Time and distance removal model

```{r clear space}
# Clean your workspace to reset your R environment
rm( list = ls() )
# Check that you are in the right project folder
getwd()
```

## Library

```{r library}


library(unmarked)

```

## Load data

```{r load data}

# WIPT male count data:

wiptmale <- read.csv("E:/gyrf_analysis/MSgyrfalcon/MSgyrfalcon/wiptmale.csv")



wipt.male.3int <- read.csv("E:/gyrf_analysis/MSgyrfalcon/MSgyrfalcon/wipt_male_df_timeanddist_18Oct23.csv")

wipt.male.3int <- read.csv("E:/gyrf_analysis/MSgyrfalcon/MSgyrfalcon/wipt_male_df_3inttimeanddist_19Oct23.csv")


env <- read.csv("E:/gyrf_analysis/MSgyrfalcon/MSgyrfalcon/all_env_17Oct23.csv")
```

## Create unmarkedFrameGDR

### Distance Matrix

```{r distance matrix}

library(tidyr)


### NEED TO CLEAN THIS UP

# create distance bins? or just say every meter is a bin so would have 401 breaks
wiptdist <- wiptmale[,c(2,4,6)]
wiptdist$exact_distance[wiptdist$count == 0] <- NA
# remove all rows with NAs
wiptcounts <- wiptdist %>%
  filter(!is.na(exact_distance))

sum(wiptcounts$count)

aggregated_df <- wiptcounts %>%
  group_by(id, exact_distance) %>%
  summarise(count = sum(count))
sum(aggregated_df$count)

aggregated_df$id <- as.factor(aggregated_df$id)
env$id <- as.factor(env$id)

# now include sites that didn't have individuals:

levels(aggregated_df$id) <- c(levels(env$id))
levels(aggregated_df$id)

wipt <- as.data.frame(aggregated_df)
wipt$exact_distance <- as.numeric(wipt$exact_distance)

expand <- wipt %>%
  uncount(count)

yDat <- formatDistData(expand, distCol = "exact_distance", transectNameCol = "id", dist.breaks = c(0, 50, 100, 150, 200, 250, 300, 350, 400 ))

sum(yDat[,c(1:8)])
```

### Time Removal Matrix

```{r}

yRem <- read.csv("E:/gyrf_analysis/MSgyrfalcon/MSgyrfalcon/wipt_male_wide_18Oct23.csv")

time <- wiptmale[,c(2,3,6)]

levels(time$id) <- c(levels(env$id))
levels(time$id)

#uncount groups so each individual has its own row

expandtime <- time %>%
  uncount(count)

yRem <- formatDistData(expandtime, distCol = "time_int", transectNameCol = "id", dist.breaks = c(0, 1, 2, 3, 4, 5))

sum(yRem[,c(1:5)])
```
